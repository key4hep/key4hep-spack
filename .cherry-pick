git remote add jmcarcell https://github.com/jmcarcell/spack || true
git fetch jmcarcell -q

# Hardcode CMAKE_INSTALL_LIBDIR to lib. This is needed for AlmaLinux 9 where
# CMAKE_INSTALL_LIBDIR gets chosen as lib64 and this causes problems in some
# packages that expect lib. Since spack installs each package to its own prefix
# we don't need to worry about multilib environments
git cherry-pick 42c070632bcb0f8333bc029e17a53646d9589d7e -X theirs --no-commit

# add a recent version of madgraph, remove when https://github.com/spack/spack/pull/41128 is merged
curl -s https://patch-diff.githubusercontent.com/raw/spack/spack/pull/41128.diff | patch -p1

# add vdt for CPATH, needed for podio+rntuple
git cherry-pick f97fabc3ff12527e5220ea6917719a73f8bd4315 -X theirs --no-commit

# podio: add rpath, remove when https://github.com/spack/spack/pull/42844 is merged
curl -s https://patch-diff.githubusercontent.com/raw/spack/spack/pull/42844.diff | patch -p1

# geant4 twisted tubes: remove when https://github.com/spack/spack/pull/45368 is merged or after 11.2.2
# curl -s https://patch-diff.githubusercontent.com/raw/spack/spack/pull/45368.diff | patch -p1

# geant4 gen trap fix, remove after 11.2.2
# git cherry-pick 8daeaeac29e817f85d86fcfa85b3293a7465b280 -X theirs --no-commit

# Both geant4 changes in a single commit
git cherry-pick c8191268c3ea4aca6e870ad40d695e92f94d0e47 -X theirs --no-commit

if [[ "$(grep -E '^ID=' /etc/os-release)" = 'ID=ubuntu' && "$(grep -E 'VERSION_ID' /etc/os-release)" = 'VERSION_ID="22.04"' ]]; then

  # patch to rename libz so texlive can be built
  git cherry-pick f8c6f240ba9b99218eb72bfadce9f99952fec1de -X theirs --no-commit

fi

zziplib: add 0.13.78, remove!
git cherry-pick db5538f5f12de8d1599ef4339e2dd1756d1230ad -X theirs --no-commit

pybind11: fix pkgconfig, remove when https://github.com/spack/spack/pull/46298 is merged
curl -s https://patch-diff.githubusercontent.com/raw/spack/spack/pull/46298.diff | patch -p1

gaudi: add patches for GCC 14, remove when https://github.com/spack/spack/pull/46365 is merged
git cherry-pick 3d7ebedd6c7bacbce6860100a03abb6ff3696732 -X theirs --no-commit

py-awkward and py-awkward-cpp: fixes, remove when https://github.com/spack/spack/pull/46372 is merged
curl -s https://patch-diff.githubusercontent.com/raw/spack/spack/pull/46372.diff | patch -p1
