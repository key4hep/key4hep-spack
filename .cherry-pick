git remote add jmcarcell https://github.com/jmcarcell/spack || true
git fetch jmcarcell -q

# Hardcode CMAKE_INSTALL_LIBDIR to lib. This is needed for AlmaLinux 9 where
# CMAKE_INSTALL_LIBDIR gets chosen as lib64 and this causes problems in some
# packages that expect lib. Since spack installs each package to its own prefix
# we don't need to worry about multilib environments
git cherry-pick 42c070632bcb0f8333bc029e17a53646d9589d7e -X theirs --no-commit

# Because the patch above and py-onnx being a python package, it will try to find
# protobuf in CMAKE_INSTALL_LIBDIR which is lib64 so a symlink is created here
git cherry-pick 3ec184fad8582cc501f55e0ea0b0f6b3fb9b70bf -X theirs --no-commit

# add vdt for CPATH, needed for podio+rntuple
git cherry-pick f97fabc3ff12527e5220ea6917719a73f8bd4315 -X theirs --no-commit

# podio: add rpath, remove when https://github.com/spack/spack/pull/42844 is merged
curl -s https://patch-diff.githubusercontent.com/raw/spack/spack/pull/42844.diff | patch -p1

# py-awkward: add py-importlib-metadata to the dependencies, remove when https://github.com/spack/spack/pull/47027 is merged
git cherry-pick a2e5fecea7740ee522a4978784082e9a9106bb58 -X theirs --no-commit

# pandora: set the C++ standards, remove when https://github.com/spack/spack/pull/48300 is merged
git cherry-pick b61942b3d57f492d09fb4da3e681f88d683f9563 -X theirs --no-commit

# gaudi: add v39.2 and a fix for compiling on GCC 11
curl -s https://patch-diff.githubusercontent.com/raw/spack/spack/pull/48557.diff | patch -p1